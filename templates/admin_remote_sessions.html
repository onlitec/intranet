{% extends "base.html" %}

{% block title %}Hist√≥rico de Acesso Remoto{% endblock %}
{% block page_title %}Auditoria: Acesso Remoto{% endblock %}
{% block page_subtitle %}Registro de sess√µes e orquestra√ß√£o entre agentes{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header flex justify-between items-center">
        <h3 class="card-title">Sess√µes Remotas Realizadas</h3>
        <div class="topbar-status">
            <span class="status-dot"></span>
            <span>Monitoramento Ativo</span>
        </div>
    </div>
    <div class="card-body p-0">
        <div class="table-container">
            <table class="data-table">
                <thead>
                    <tr>
                        <th>üïí In√≠cio / Fim</th>
                        <th>üë®‚Äçüíª Administrador</th>
                        <th>üíª Dispositivo Alvo</th>
                        <th>üåê IP Origem</th>
                        <th>üõ°Ô∏è Status</th>
                        <th>üõ†Ô∏è A√ß√µes Cr√≠ticas</th>
                    </tr>
                </thead>
                <tbody>
                    {% for session in sessions %}
                    <tr>
                        <td>
                            <div class="timestamp-badge">
                                {{ session.start_time|localdatetime|strftime('%d/%m/%Y %H:%M:%S') }}
                                <br>
                                <span class="text-muted text-xs">
                                    {% if session.end_time %}
                                    Fim: {{ session.end_time|localdatetime|strftime('%H:%M:%S') }}
                                    {% else %}
                                    <span class="badge badge-success">Em curso...</span>
                                    {% endif %}
                                </span>
                            </div>
                        </td>
                        <td>
                            <div class="font-bold">{{ session.admin.full_name }}</div>
                            <div class="text-muted text-xs">@{{ session.admin.username }}</div>
                        </td>
                        <td>
                            <div class="flex items-center gap-2">
                                <span>{{ session.device.get_icon() }}</span>
                                <div>
                                    <div class="font-bold">{{ session.device.hostname }}</div>
                                    <code class="text-xs">{{ session.device.mac_address }}</code>
                                </div>
                            </div>
                        </td>
                        <td>
                            <code class="text-xs">{{ session.admin_ip }}</code>
                        </td>
                        <td>
                            {% if session.status == 'completed' %}
                            <span class="badge badge-info">Conclu√≠do</span>
                            {% elif session.status == 'active' %}
                            <span class="badge badge-success">Ativo</span>
                            {% else %}
                            <span class="badge badge-error">{{ session.status }}</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="text-xs">
                                {{ session.critical_actions or '---' }}
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center p-12">
                            <div class="text-4xl mb-4">üõ°Ô∏è</div>
                            <div class="text-lg font-bold">Nenhuma sess√£o remota registrada</div>
                            <p class="text-muted">Os logs aparecer√£o aqui assim que os Agentes Admin iniciarem acessos.
                            </p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}