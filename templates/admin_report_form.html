{% extends "base.html" %}

{% block title %}{{ 'Editar' if schedule else 'Novo' }} Agendamento{% endblock %}
{% block page_title %}{{ 'Editar' if schedule else 'Novo' }} Agendamento de Relat√≥rio{% endblock %}

{% block content %}
<div class="content-narrow">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title">üìÖ {{ '‚úèÔ∏è Editar' if schedule else '‚ûï Configura√ß√µes do' }} Relat√≥rio</h3>
        </div>
        <div class="card-body">
            <form method="POST"
                action="{{ url_for('admin.reports_edit', schedule_id=schedule.id) if schedule else url_for('admin.reports_new') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-group">
                    <label for="name" class="form-label required">Nome do Relat√≥rio</label>
                    <input type="text" id="name" name="name" class="form-control"
                        value="{{ schedule.name if schedule else '' }}" placeholder="Ex: Relat√≥rio de Seguran√ßa Semanal"
                        required>
                </div>

                <div class="form-group">
                    <label for="report_type" class="form-label required">Tipo de Relat√≥rio</label>
                    <select id="report_type" name="report_type" class="form-control" required>
                        <option value="server_activity" {% if not schedule or schedule.report_type=='server_activity'
                            %}selected{% endif %}>Atividade do Servidor (Arquivos/Login)</option>
                        <option value="internet_monitoring" {% if schedule and
                            schedule.report_type=='internet_monitoring' %}selected{% endif %}>Monitoramento de Internet
                            (Acessos/Sites)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="frequency" class="form-label required">Frequ√™ncia / Per√≠odo</label>
                    <select id="frequency" name="frequency" class="form-control" onchange="toggleCustomDays()" required>
                        <option value="daily" {% if schedule and schedule.frequency=='daily' %}selected{% endif %}>
                            Di√°rio (√öltimas 24h)</option>
                        <option value="weekly" {% if not schedule or schedule.frequency=='weekly' %}selected{% endif %}>
                            Semanal (√öltimos 7 dias)</option>
                        <option value="monthly" {% if schedule and schedule.frequency=='monthly' %}selected{% endif %}>
                            Mensal (√öltimos 30 dias)</option>
                        <option value="custom" {% if schedule and schedule.frequency=='custom' %}selected{% endif %}>
                            Personalizada (Definir dias)</option>
                    </select>
                </div>

                <div class="form-group {% if not (schedule and schedule.frequency == 'custom') %}is-hidden{% endif %}"
                    id="customDaysGroup">
                    <label for="custom_days" class="form-label required">Quantidade de Dias</label>
                    <input type="number" id="custom_days" name="custom_days" class="form-control"
                        value="{{ schedule.custom_days or 1 }}" min="1">
                    <small class="text-muted">O relat√≥rio incluir√° atividades dos √∫ltimos X dias.</small>
                </div>

                <div class="form-group">
                    <label for="recipients" class="form-label required">Destinat√°rios (E-mails)</label>
                    <input type="text" id="recipients" name="recipients" class="form-control"
                        value="{{ schedule.recipients if schedule else '' }}"
                        placeholder="TI@empresa.com, admin@empresa.com" required>
                    <small class="text-muted">Separe m√∫ltiplos e-mails por v√≠rgula</small>
                </div>

                {% if schedule %}
                <div class="form-group mt-4">
                    <label class="checkbox-container">
                        <input type="checkbox" name="is_active" {% if schedule.is_active %}checked{% endif %}>
                        <span class="checkmark"></span>
                        Agendamento Ativo
                    </label>
                </div>
                {% endif %}

                <div class="form-actions mt-8">
                    <button type="submit" class="btn btn-primary">üíæ {{ 'Salvar Altera√ß√µes' if schedule else 'Criar
                        Agendamento' }}</button>
                    <a href="{{ url_for('admin.report_schedules') }}" class="btn btn-secondary">Cancelar</a>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    function toggleCustomDays() {
        const freq = document.getElementById('frequency').value;
        const group = document.getElementById('customDaysGroup');
        group.classList.toggle('is-hidden', freq !== 'custom');
    }
</script>
{% endblock %}