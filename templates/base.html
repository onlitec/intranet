<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Intranet Corporativa ES-SERVIDOR - Sistema de Gerenciamento">
    <meta name="author" content="ES-SERVIDOR">
    <title>{% block title %}Intranet{% endblock %} - ES-SERVIDOR</title>

    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='images/logo.png') }}">

    {% block extra_head %}{% endblock %}
</head>

<body class="{% block body_class %}app-layout{% endblock %}">
    {% block body %}
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <a href="{{ url_for('home') }}" class="sidebar-logo">
                <img src="{{ url_for('static', filename='images/logo.png') }}" alt="Logo"
                    onerror="this.style.display='none'">
                <div>
                    <div class="sidebar-logo-text">ES-SERVIDOR</div>
                    <div class="sidebar-logo-subtitle">Intranet</div>
                </div>
            </a>
        </div>

        <nav class="sidebar-nav">
            {% if session.get('is_admin') %}
            <!-- Admin Navigation -->
            <div class="nav-section">
                <div class="nav-section-title">VisÃ£o Geral</div>
                <a href="{{ url_for('admin.dashboard') }}"
                    class="nav-item {% if request.endpoint == 'admin.dashboard' %}active{% endif %}">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span>Dashboard</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Servidor</div>
                <a href="{{ url_for('admin.storage') }}"
                    class="nav-item {% if request.endpoint == 'admin.storage' %}active{% endif %}">
                    <span class="nav-icon">ğŸ’¾</span>
                    <span>Armazenamento</span>
                </a>
                <a href="{{ url_for('admin.shares') }}"
                    class="nav-item {% if request.endpoint == 'admin.shares' %}active{% endif %}">
                    <span class="nav-icon">ğŸ“</span>
                    <span>Compartilhamentos</span>
                </a>
                <a href="{{ url_for('admin.server_users') }}"
                    class="nav-item {% if request.endpoint == 'admin.server_users' %}active{% endif %}">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span>UsuÃ¡rios Servidor</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Intranet</div>
                <a href="{{ url_for('admin.users_list') }}"
                    class="nav-item {% if request.endpoint in ['admin.users_list', 'admin.users_new', 'admin.users_edit'] %}active{% endif %}">
                    <span class="nav-icon">ğŸ”‘</span>
                    <span>UsuÃ¡rios Intranet</span>
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Monitoramento</div>
                <a href="{{ url_for('admin.audit_logs') }}"
                    class="nav-item {% if request.endpoint == 'admin.audit_logs' %}active{% endif %}">
                    <span class="nav-icon">ğŸ”</span>
                    <span>Atividades do Servidor</span>
                </a>
                <a href="{{ url_for('admin.logs') }}"
                    class="nav-item {% if request.endpoint == 'admin.logs' %}active{% endif %}">
                    <span class="nav-icon">ğŸ“‹</span>
                    <span>Logs Internos</span>
                </a>
            </div>

            {% elif current_user.is_authenticated %}
            <!-- User Navigation -->
            <div class="nav-section">
                <div class="nav-section-title">Menu</div>
                <a href="{{ url_for('dashboard') }}"
                    class="nav-item {% if request.endpoint == 'dashboard' %}active{% endif %}">
                    <span class="nav-icon">ğŸ </span>
                    <span>Meus Compartilhamentos</span>
                </a>
            </div>
            {% endif %}
        </nav>

        <div class="sidebar-footer">
            {% if session.get('is_admin') %}
            <div class="sidebar-user">
                <div class="sidebar-user-avatar">A</div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name">{{ session.get('admin_name', 'Admin') }}</div>
                    <div class="sidebar-user-role">Administrador</div>
                </div>
            </div>
            <form action="{{ url_for('admin.logout') }}" method="POST" style="margin-top: 12px;">
                <button type="submit" class="btn btn-ghost btn-block btn-sm"
                    style="justify-content: flex-start; color: var(--sidebar-text);">
                    ğŸšª Sair
                </button>
            </form>
            {% elif current_user.is_authenticated %}
            <div class="sidebar-user">
                <div class="sidebar-user-avatar">{{ current_user.full_name[0] if current_user.full_name else 'U' }}
                </div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name">{{ current_user.full_name }}</div>
                    <div class="sidebar-user-role">UsuÃ¡rio</div>
                </div>
            </div>
            <form action="{{ url_for('do_logout') }}" method="POST" style="margin-top: 12px;">
                <button type="submit" class="btn btn-ghost btn-block btn-sm"
                    style="justify-content: flex-start; color: var(--sidebar-text);">
                    ğŸšª Sair
                </button>
            </form>
            {% endif %}
        </div>
    </aside>

    <!-- Main Content Wrapper -->
    <div class="main-wrapper">
        <!-- Topbar -->
        <header class="topbar">
            <div class="topbar-left">
                <div>
                    <h1 class="topbar-title">{% block page_title %}Dashboard{% endblock %}</h1>
                    {% block page_subtitle %}<p class="topbar-subtitle">VisÃ£o geral do sistema</p>{% endblock %}
                </div>
            </div>
            <div class="topbar-right">
                <div id="server-status" class="topbar-status">
                    <span class="status-dot"></span>
                    <span id="status-text">Verificando...</span>
                </div>
            </div>
        </header>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="flash-container" style="padding: 24px 24px 0;">
            {% for category, message in messages %}
            <div class="alert alert-{{ category }}">
                <span class="alert-icon">
                    {% if category == 'success' %}âœ“{% elif category == 'error' %}âœ•{% elif category == 'warning' %}âš {%
                    else %}â„¹{% endif %}
                </span>
                <span class="alert-message">{{ message }}</span>
            </div>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        <!-- Main Content -->
        <main class="main-content">
            {% block content %}{% endblock %}
        </main>
    </div>
    {% endblock %}

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>

    <!-- Server Status Check -->
    <script>
        (function () {
            const statusEl = document.getElementById('server-status');
            const textEl = document.getElementById('status-text');
            if (!statusEl || !textEl) return;

            fetch('/api/status')
                .then(r => r.json())
                .then(data => {
                    if (data.esservidor_connection) {
                        statusEl.classList.remove('offline');
                        textEl.textContent = 'Online';
                    } else {
                        statusEl.classList.add('offline');
                        textEl.textContent = 'Offline';
                    }
                })
                .catch(() => {
                    statusEl.classList.add('offline');
                    textEl.textContent = 'Erro';
                });
        })();
    </script>

    {% block extra_scripts %}{% endblock %}
</body>

</html>